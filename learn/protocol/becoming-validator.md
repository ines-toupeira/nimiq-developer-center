# Proof-of-Stake Testnet


## 1. Setup Your Client

This guide assumes the client has been compiled. Check [this guide]() for more information on installing the code. All of the commands in this guide use [arpl](https://github.com/sisou/arpl) for sending JSON-RPC commands. To install it, run:

```
npm install -g @sisou/albatross-remote
```

Refer to this other guide for sending raw commands using `JSONRPC-CLI`.

<br/>

## 2. Create Your Validator

### 2.1 Generate Your Validator Address and Keys

To run a validator, youâ€™ll need the following:

- A validator address: Nimiq address
- A signing keypair: Schnorr key
- A fee keypair: Schnorr key
- A voting keypair: BLS key

<br/>

> ðŸ’¡ Make sure you write down your keys, and save the private keys securely! There is no way to recover your private keys.

<br/>

To generate the Schnorr keypairs and the validator address, run:

```
# Since we require two different Schnorr keys and a Nimiq address, this command must be run three times.
cargo run --release --bin nimiq-address

```

<br/>

To generate a BLS keypair, run:

```
cargo run --release --bin nimiq-bls
```

### 2.2 Configure Your Client

You need to copy `~/.nimiq/client.toml.example` to `~/.nimiq/client.toml`. You can leave all configuration options as they are for now to start a full node.

<br/>

To control your node and validate, enable the JSON-RPC server in your `client.toml` under the `[rpc-server]` section.

<br/>

You can also configure your node to use `history` as the `sync_mode`. For that, you could change the `consensus` section of your config file to set `sync_mode` like in the following example:

```
[consensus]
sync_mode = "history"
```

<br/>

> ðŸ’¡ Although running a validator as a history node is possible, it's important to note that this mode often requires a lengthy syncing process. As such, we recommend opting for a full node setup for quicker synchronization.

<br/>

The next step is to setup your validator in the `validator` section by replacing the validator address and keys with the generated values.:

```
[validator]
validator_address = "NQXX XXXX XXXX XXXX XXXX XXXX XXXX XXXX XXXX"
signing_key_file = "signing_key.dat"
voting_key_file = "voting_key.dat"
fee_key_file = "fee_key.dat"
signing_key = "Schnorr Private Key"
fee_key = "Schnorr Private Key"
voting_key = "BLS Private Key"
automatic_reactivate = true
```

<br/>

- The validator address corresponds to the address output of the `nimiq-address` command run the first time.
- The signing key corresponds to the private key output of the `nimiq-address` command run the second time.
- The voting key in the config file corresponds to the secret key generated by the `nimiq-bls` command.
- The fee key corresponds to the private key output of the `nimiq-address` command run the third time.
- The `automatic_reactivate` setting enables a deactivated validator to reactivate automatically in the next block; otherwise, the validator must manually send a reactivate transaction. Please note that reactivation is exclusive to validators that are not jailed.

<br/>

## 3. TLS Certificate

For enhanced security when connecting your nimiq-pos wallet to a validator, it's recommended to use a TLS certificate. This ensures a secure connection between the wallet and validator. Connecting to as many diverse validators as possible is advisable to maintain a healthy decentralization level within the network.

To obtain a TLS certificate, consider services like Let's Encrypt. Once obtained, specify the certificate in the config file's Network-TLS section:

```
[network.tls]
private_key = "./my_private_key.pem"
certificates = "./my_certificate.pem"
```

> Include the full chain of certificates in the `pem` file to verify its validity. This chain is usually provided by the TLS certificate service.
> 

<br/>

## 4. Sync with the Blockchain

Once you have completed your configuration, in the `core-rs-albatross` directory, run:

```
cargo run --release --bin nimiq-client
```


This connects the client to the seed node, then to other nodes, and syncs with the blockchain.

<br/>

## 5. Connect `arpl` to Your Node

To become a validator, ensure `arpl` is connected to your node using the port specified in the [configuration file](https://github.com/nimiq/core-rs-albatross/blob/761e6e9a60fb82993b2fa17087a22b9232553cff/lib/src/config/config_file/client.example.toml#L137). Start an interactive session, and run:

```
bin/run repl -u ws://<host>:<port>/ws
```

<br/>

### 5.1 Check Your Status

Once in the session, check the status with:

```
status
```

<br/>

## 6. Become a Validator

Follow the transactions below to become a validator and start producing blocks. Keep in mind that validators are selected for block production at every election block, so it may take some time for your validator to be elected for the next epoch.

<br/>

### 6.1 Check Your Balance

To become a validator, you need to send a **create** validator transaction. Ensure your account holds at least the validator deposit fee of 100 000 NIM. This guide assumes the required amount is already present in the validator address. If not, please fund your address. Check your balance using:

```
account:get <validator_address>
```

<br/>

### 6.2 Import and Unlock Your Validator

Import and unlock your validator with:

```
account:import <validator_private_key> # This is the private key corresponding to your validator address

account:unlock <validator_address>
```

<br/>

### 6.3 Create Your Validator

Finally, you can send the **create** transaction:

```
validator:new <validator_address> <signing_private_key> <voting_private_key>
```

<br/>

> ðŸ’¡ When sending the **create** transaction, the validator deposit will be deducted from the wallet linked to the validator address.

<br/>

### 6.4 Other Useful Transactions

**Update**

```
command
```

Update data on your validator such as voting and signing key, reward address or signal data. No caso do signal data, pode ser sÃ³ avisar os outros validadores que vou fazer um upgrade ou que sou buÃ© fixe

<br/>

**Reactivate**

```
command
```

Send this transaction if your validator does not have the  `automatic_reactivate` configuration enabled and you wish to reactivate your validator. Please note that reactivation is only possible if your validator is not currently jailed or retired.

<br/>

> ðŸ’¡ The fee key is used to cover the `automatic_reactivate` transaction fee. Ensure you have sufficient funds to cover these fees if you have this feature activated.

<br/>

**Deactivate**

```
command
```

Both the reactivate and deactivate transactions take effect immediately but you are only added or removed from the staking contract at the next epoch.

<br/>

## Addendum for Stakers

If you choose not to become a validator but wish to stake NIM with a validator, you can create a staker account.

<br/>

### Create Staker

```
command
```